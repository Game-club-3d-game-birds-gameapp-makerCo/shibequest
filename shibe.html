<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--
Sugarcane 1.2.1 is based on:

TiddlyWiki 1.2.39 by Jeremy Ruston, (jeremy [at] osmosoft [dot] com)

Published under a BSD open source license

Copyright (c) Osmosoft Limited 2005

Redistribution and use in source and binary forms, with or without modification,
are permitted provided that the following conditions are met:

Redistributions of source code must retain the above copyright notice, this
list of conditions and the following disclaimer.

Redistributions in binary form must reproduce the above copyright notice, this
list of conditions and the following disclaimer in the documentation and/or other
materials provided with the distribution.

Neither the name of the Osmosoft Limited nor the names of its contributors may be
used to endorse or promote products derived from this software without specific
prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY
EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT
SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH
DAMAGE.
-->
<html>
<head>
<meta http-equiv="Content-Type" content="text/xhtml; charset=UTF-8">
<title>Sugarcane</title>
<script type="text/javascript">
function $(a){if(typeof a=="string"){return document.getElementById(a)}else{return a}}function clone(a){var b={};for(property in a){b[property]=a[property]}return b}function insertElement(a,d,f,c,e){var b=document.createElement(d);if(f){b.id=f}if(c){b.className=c}if(e){insertText(b,e)}if(a){a.appendChild(b)}return b}function insertText(a,b){return a.appendChild(document.createTextNode(b))}function removeChildren(a){while(a.hasChildNodes()){a.removeChild(a.firstChild)}}function setPageElement(c,b,a){if(place=$(c)){removeChildren(place);if(tale.has(b)){new Wikifier(place,tale.get(b).text)}else{new Wikifier(place,a)}}}function addStyle(b){if(document.createStyleSheet){document.getElementsByTagName("head")[0].insertAdjacentHTML("beforeEnd","&nbsp;<style>"+b+"</style>")}else{var a=document.createElement("style");a.type="text/css";a.appendChild(document.createTextNode(b));document.getElementsByTagName("head")[0].appendChild(a)}}function throwError(a,b){new Wikifier(a,"'' @@ "+b+" @@ ''")}Math.easeInOut=function(a){return(1-((Math.cos(a*Math.PI)+1)/2))};String.prototype.readMacroParams=function(){var c=new RegExp("(?:\\s*)(?:(?:\"([^\"]*)\")|(?:'([^']*)')|(?:\\[\\[([^\\]]*)\\]\\])|([^\"'\\s]\\S*))","mg");var b=[];do{var a=c.exec(this);if(a){if(a[1]){b.push(a[1])}else{if(a[2]){b.push(a[2])}else{if(a[3]){b.push(a[3])}else{if(a[4]){b.push(a[4])}}}}}}while(a);return b};String.prototype.readBracketedList=function(){var b="\\[\\[([^\\]]+)\\]\\]";var a="[^\\s$]+";var e="(?:"+b+")|("+a+")";var d=new RegExp(e,"mg");var f=[];do{var c=d.exec(this);if(c){if(c[1]){f.push(c[1])}else{if(c[2]){f.push(c[2])}}}}while(c);return(f)};String.prototype.trim=function(){return this.replace(/^\s\s*/,"").replace(/\s\s*$/,"")};Array.prototype.indexOf||(Array.prototype.indexOf=function(b,d){d=(d==null)?0:d;var a=this.length;for(var c=d;c<a;c++){if(this[c]==b){return c}}return-1});function fade(f,c){var h;var e=f.cloneNode(true);var g=(c.fade=="in")?1:-1;f.parentNode.replaceChild(e,f);if(c.fade=="in"){h=0;e.style.visibility="visible"}else{h=1}b(e,h);var a=window.setInterval(d,25);function d(){h+=0.05*g;b(e,Math.easeInOut(h));if(((g==1)&&(h>=1))||((g==-1)&&(h<=0))){f.style.visibility=(c.fade=="in")?"visible":"hidden";e.parentNode.replaceChild(f,e);delete e;window.clearInterval(a);if(c.onComplete){c.onComplete()}}}function b(k,j){var l=Math.floor(j*100);k.style.zoom=1;k.style.filter="alpha(opacity="+l+")";k.style.opacity=j}}function scrollWindowTo(e){var d=window.scrollY?window.scrollY:document.body.scrollTop;var g=k(e);var c=Math.abs(d-g);var b=0;var j=(d>g)?-1:1;var f=window.setInterval(h,25);function h(){b+=0.1;window.scrollTo(0,d+j*(c*Math.easeInOut(b)));if(b>=1){window.clearInterval(f)}}function k(o){var p=a(o);var q=p+o.offsetHeight;var l=window.scrollY?window.scrollY:document.body.scrollTop;var m=window.innerHeight?window.innerHeight:document.body.clientHeight;var n=l+m;if(p<l){return p}else{if(q>n){if(o.offsetHeight<m){return(p-(m-o.offsetHeight)+20)}else{return p}}else{return p}}}function a(l){var m=0;while(l.offsetParent){m+=l.offsetTop;l=l.offsetParent}return m}}function History(){this.history=[{passage:null,variables:{},hash:null}]}History.prototype.init=function(){var a=this;if(!this.restore()){this.display("Start",null)}this.hash=window.location.hash;this.interval=window.setInterval(function(){a.watchHash.apply(a)},250)};History.prototype.display=function(d,b,a){var c=tale.get(d);this.history.unshift({passage:c,variables:clone(this.history[0].variables)});this.history[0].hash=this.save();var e=c.render();if(a!="offscreen"){removeChildren($("passages"));$("passages").appendChild(e);if(a!="quietly"){fade(e,{fade:"in"})}}if((a=="quietly")||(a=="offscreen")){e.style.visibility="visible"}if(a!="offscreen"){document.title=tale.title;this.hash=this.save(); document.title+=": "+c.title;window.location.hash=this.hash; window.scroll(0,0)}return e};History.prototype.restart=function(){window.location.hash=""};History.prototype.save=function(c){var a="";for(var b=this.history.length-1;b>=0;b--){if((this.history[b].passage)&&(this.history[b].passage.id)){a+=this.history[b].passage.id.toString(36)+"."}}return"#"+a.substr(0,a.length-1)};History.prototype.restore=function(){try{if((window.location.hash=="")||(window.location.hash=="#")){return false}if(window.location.hash.substr(0,2)=='#!'){var mt = window.location.hash.substr(2).split('_').join(' ');console.log('Using hashbang to find' + mt);$('passages').appendChild(this.display(mt, null,'quietly'));return true;}var a=window.location.hash.replace("#","").split(".");var c=[];for(var b=0;b<a.length;b++){var g=parseInt(a[b],36);if(!tale.has(g)){return false}var f=(b==a.length-1)?"":"offscreen";c.unshift(this.display(g,null,f))}return true}catch(d){return false}};History.prototype.watchHash=function(){if(window.location.hash!=this.hash){if((window.location.hash!="")&&(window.location.hash!="#")){this.history=[{passage:null,variables:{}}];removeChildren($("passages"));$("passages").style.visibility="hidden";if(!this.restore()){alert("The passage you had previously visited could not be found.")}$("passages").style.visibility="visible"}else{window.location.reload()}this.hash=window.location.hash}};var version={major:2,minor:0,revision:0,date:new Date("July 30, 2007"),extensions:{}};var tale,state;var macros={};
function main(){
    tale=new Tale();
    state=new History();
    document.title=tale.title;
    setPageElement("storyTitle","StoryTitle","Untitled Story");
    setPageElement("storySubtitle", "StorySubtitle", "");
    if(tale.has("StoryAuthor")){
        $("titleSeparator").innerHTML="<br />";
        setPageElement("storyAuthor","StoryAuthor","");
    }
    if(tale.has("StoryMenu")){
        $("storyMenu").style.display="inline";
        setPageElement("storyMenu","StoryMenu","");
    }
    var scripts=tale.lookup("tags","script");
    for(var i=0;i<scripts.length;i++) {
        try {
            eval(scripts[i].text);
        } catch(e) {
            alert("There is a technical problem with this story ("+scripts[i].title+": "+e.message+"). You may be able to continue reading, but all parts of the story may not work properly.");
        }
    }
    for(var macroidx in macros){
        var macro = macros[macroidx];
        if(typeof macro.init=="function") {
            macro.init();
        }
    }
    var styles=tale.lookup("tags","stylesheet");
    for(var i=0;i<styles.length;i++){ addStyle(styles[i].text); }
    state.init();
};

Interface={init:function(){main();$("snapback").onclick=Interface.showSnapback;$("restart").onclick=Interface.restart;$("share").onclick=Interface.showShare},restart:function(){if(confirm("Are you sure you want to restart this story?")){state.restart()}},showShare:function(a){Interface.hideAllMenus();Interface.showMenu(a,$("shareMenu"))},showSnapback:function(a){Interface.hideAllMenus();Interface.buildSnapback();Interface.showMenu(a,$("snapbackMenu"))},buildSnapback:function(){var c=false;removeChildren($("snapbackMenu"));for(var a=state.history.length-1;a>=0;a--){if(state.history[a].passage&&state.history[a].passage.tags.indexOf("bookmark")!=-1){var b=document.createElement("div");b.hash=state.history[a].hash;b.onclick=function(){window.location.hash=this.hash};b.innerHTML=state.history[a].passage.excerpt();$("snapbackMenu").appendChild(b);c=true}}if(!c){var b=document.createElement("div");b.innerHTML="<i>No passages available</i>";$("snapbackMenu").appendChild(b)}},hideAllMenus:function(){$("shareMenu").style.display="none";$("snapbackMenu").style.display="none"},showMenu:function(b,a){if(!b){b=window.event}var c={x:0,y:0};if(b.pageX||b.pageY){c.x=b.pageX;c.y=b.pageY}else{if(b.clientX||b.clientY){c.x=b.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;c.y=b.clientY+document.body.scrollTop+document.documentElement.scrollTop}}a.style.top=c.y+"px";a.style.left=c.x+"px";a.style.display="block";document.onclick=Interface.hideAllMenus;b.cancelBubble=true;if(b.stopPropagation){b.stopPropagation()}}};window.onload=Interface.init;version.extensions.backMacro={major:1,minor:0,revision:0};macros.back={handler:function(a,b,e){var f=RegExp(/\./);if(f.test(state.history[0].hash)){var c="";var d="";var f="";if(e[0]){if(e[1]=="steps"){if(isNaN(e[0])){throwError(a,"paramater before \"steps\" must to be a number.");return}else{if(e[0]<state.history[0].hash.match(/\./g).length){d=state.history[e[0]].hash}else{return}}}else{if(tale.get(e[0]).id==undefined){throwError(a,"The "+e[0]+" passage does not exist");return}h=tale.get(e[0]);h=new RegExp("(\.|#)"+h.id.toString(36));if(h.test(state.history[1].hash)){var i=0;if(e[0]==state.history[0].passage.title){i=1}for(c=i;c<state.history.length;c++){if(state.history[c].passage.title==e[0]){d=state.history[c].hash;break}}}}}else{d=state.history[1].hash}if(d==""){return}else{el=document.createElement("a");el.className="return";el.href=d;el.innerHTML="<b>&laquo;</b> Back";a.appendChild(el)}}}};version.extensions.returnMacro={major:1,minor:0,revision:0};macros.return={handler:function(a,b,e){var f=RegExp(/\./);if(f.test(state.history[0].hash)){var c="";var d="";var f="";var g="";var h="";if(e[0]){if(e[1]=="steps"){if(isNaN(e[0])){throwError(a,"paramater before \"steps\" must to be a number.");return}else{if(e[0]<=state.history[0].hash.match(/\./g).length){g=state.history[e[0]].passage.id.toString(36);d=state.history[0].hash+"."+g}else{return}}}else{if(tale.get(e[0]).id==undefined){throwError(a,"The "+e[0]+" passage does not exist");return}h=tale.get(e[0]);h=new RegExp("(\.|#)"+h.id.toString(36));if(h.test(state.history[0].hash)){for(var c=0;c<state.history.length;c++){if(state.history[c].passage.title==e[0]){g=state.history[c].passage.id.toString(36);d=state.history[0].hash+"."+g;break}}}}}else{for(c=1;c<state.history.length;c++){if(state.history[c].passage.title!=state.history[0].passage.title){g=state.history[c].passage.id.toString(36);break}}d=state.history[0].hash+"."+g}if(d==state.history[0].hash){return}if(d==""){return}else{el=document.createElement("a");el.className="return";el.href=d;el.innerHTML="<b>&laquo;</b> Return";a.appendChild(el)}}}};macros.refresh={handler:function(a,b,c){window.location.reload()}};version.extensions.displayMacro={major:1,minor:0,revision:0};macros.display={handler:function(a,b,c){if(c[0]=="_previous"){if(state.history[1]){for(var d=1;d<=state.history.length;d++){if(state.history[d].passage.title!=state.history[0].passage.title){break}}var e=state.history[d].passage.title;new Wikifier(a,tale.get(e).text)}else{retun}}else{if(tale.get(c[0]).id==undefined){throwError(a,"The "+c[0]+" passage does not exist");return}else{new Wikifier(a,tale.get(c[0]).text)}}}};version.extensions.actionsMacro={major:1,minor:2,revision:0};macros.actions={handler:function(a,f,g){var e=insertElement(a,"ul");if(!state.history[0].variables["actions clicked"]){state.history[0].variables["actions clicked"]={}}for(var b=0;b<g.length;b++){if(state.history[0].variables["actions clicked"][g[b]]){continue}var d=insertElement(e,"li");var c=Wikifier.createInternalLink(d,g[b]);insertText(c,g[b]);c.onclick=function(){state.history[0].variables["actions clicked"][this.id]=true;state.display(this.id,c)}}}};
version.extensions.printMacro={major:1,minor:1,revision:1};
macros['print']={
    handler:function(place,macroName,params,parser){try{
        var output=eval(parser.fullArgs());
        if(output != null || !isNaN(output)) { new Wikifier(place,output.toString()); }
    }catch(e){ throwError(place,"printMacro bad expression: "+e.message); }}
};
version.extensions.setMacro={major:1,minor:1,revision:0};macros.set={handler:function(a,b,c,d){macros.set.run(d.fullArgs())},run:function(expression){try{return eval(Wikifier.parse(expression))}catch(e){throwError(place,"bad expression: "+e.message)}}};version.extensions.ifMacros={major:1,minor:0,revision:0};macros["if"]={handler:function(place,macroName,params,parser){var condition=parser.fullArgs();var srcOffset=parser.source.indexOf(">>",parser.matchStart)+2;var src=parser.source.slice(srcOffset);var endPos=-1;var trueClause="";var falseClause="";for(var i=0,nesting=1,currentClause=true;i<src.length;i++){if(src.substr(i,9)=="<<endif>>"){nesting--;if(nesting==0){endPos=srcOffset+i+9;break}}if((src.substr(i,8)=="<<else>>")&&(nesting==1)){currentClause="false";i+=8}if(src.substr(i,5)=="<<if "){nesting++}if(currentClause==true){trueClause+=src.charAt(i)}else{falseClause+=src.charAt(i)}}try{if(eval(condition)){new Wikifier(place,trueClause.trim())}else{new Wikifier(place,falseClause.trim())}if(endPos!=-1){parser.nextMatch=endPos}else{throwError(place,"can't find matching endif")}}catch(e){throwError(place,"bad condition: "+e.message)}}};macros["else"]=macros.endif={handler:function(){}};

version.extensions.rememberMacro={major:2,minor:0,revision:0};
macros['remember']={
    handler: function(place,macroName,params,parser) {
        var statement=parser.fullArgs();
        var variable,value;
        macros['set'].run(statement);
        var variableSigil=Wikifier.parse("$");
        variableSigil=variableSigil.replace("[","\\[");
        variableSigil=variableSigil.replace("]","\\]");
        variable=statement.match(new RegExp(variableSigil+"(\\w+)","i"))[1];
        value=eval(Wikifier.parse("$"+variable));
        switch(typeof value){
            case"string":value='"'+value.replace(/"/g,'\\"')+'"';break;
            case"number":case"boolean":break;
            default:throwError(place,"can't remember $"+variable+" ("+(typeof value)+")");return;
        }
        if(this.uselocalstorage) {
            localStorage[this.prefix+variable] = value;
        } else {
            document.cookie=this.prefix+variable+"="+value+"; expires="+this.expire;
        }
    },
    init: function() {
        var expiredate = new Date();
        expiredate.setYear(expiredate.getFullYear()+1);
        this.expire = expiredate.toGMTString();
        if(tale.has("StoryTitle")){
            this.prefix=tale.get("StoryTitle").text+"_";
        } else {
            this.prefix="__twineremember_";
        }
        if(typeof localStorage != 'undefined' && localStorage !== null) {
            this.uselocalstorage = true;
            for(var i in localStorage) {
                if(i.indexOf(this.prefix) == 0) {
                    var variable = i.substr(this.prefix.length);
                    var value = localStorage[i];
                    eval(Wikifier.parse('$' + variable + ' = ' + value));
                }
            }
        } else {
            this.uselocalstorage = false;
            var cookies=document.cookie.split(";");
            for(var i=0;i<cookies.length;i++) {
                var bits=cookies[i].split("=");
                if(bits[0].trim().indexOf(this.prefix)==0) {
                    var statement=cookies[i].replace(this.prefix,"$");
                    eval(Wikifier.parse(statement));
                }
            }
        }
    },
    expire: null,
    uselocalstorage: null,
    prefix: null,
};

version.extensions.SilentlyMacro={major:1,minor:0,revision:0};macros.silently={handler:function(g,e,f,b){var h=insertElement(null,'div');var k=b.source.indexOf('>>',b.matchStart)+2;var a=b.source.slice(k);var d=-1;var c='';var l=0;for(var i=0;i<a.length;i++){if(a.substr(i,15)=='<<endsilently>>'){if(l==0){d=k+i+15;break;}else{l--;}}else if(a.substr(i,12)=='<<silently>>'){l++;}else{c+=a.charAt(i);}};if(d!=-1){new Wikifier(h,c);b.nextMatch=d;}else{throwError(g,"can't find matching endsilently");delete h;}}};macros.endsilently={handler:function(){}};version.extensions.choiceMacro={major:1,minor:0,revision:0};macros.choice={handler:function(a,b,c){Wikifier.createInternalLink(a,c[0])}};function Passage(c,b,a){this.title=c;if(b){this.id=a;this.initialText=this.text=Passage.unescapeLineBreaks(b.firstChild?b.firstChild.nodeValue:"");this.tags=b.getAttribute("tags");if(typeof this.tags=="string"){this.tags=this.tags.readBracketedList()}else{this.tags=[]}}else{this.initialText=this.text="@@This passage does not exist.@@";this.tags=[]}}

Passage.prototype.render = function() {
    var b = insertElement(null,'div','passage'+this.title,'passage');
    b.style.visibility='hidden';
    if(this.tags != null && this.tags.length > 0) b.setAttribute('data-tags', this.tags.join(' '));
    insertElement(b, 'div','','header');
    var a = insertElement(b, 'div', '', 'content');
    new Wikifier(a, this.text);
    insertElement(b, 'div', '', 'footer');
    return b;
};

Passage.prototype.reset=function(){this.text=this.initialText};
Passage.prototype.excerpt = function() {
    var b=this.text.replace(/<<.*?>>/g,"");
	b=b.replace(/!.*?\n/g,"");
	b=b.replace(/[\[\]\/]/g,"");
	//var a=b.match(/(.*?\s.*?\s.*?\s.*?\s.*?\s.*?\s.*?)\s/);
	var a = b.split("\n");
	while(a.length && a[0].length == 0) a.shift();
	var c ='';
	if(a.length == 0 || a[0].length == 0) c = this.title;
	else c = a[0].substr(0,30) + '...';
	return c;
};
Passage.unescapeLineBreaks=function(a){if(a&&a!=""){return a.replace(/\\n/mg,"\n").replace(/\\/mg,"\\").replace(/\r/mg,"")}else{return""}};function Tale(){this.passages={};if(document.normalize){document.normalize()}var a=$("storeArea").childNodes;for(var b=0;b<a.length;b++){var c=a[b];if(c.getAttribute&&(tiddlerTitle=c.getAttribute("tiddler"))){this.passages[tiddlerTitle]=new Passage(tiddlerTitle,c,b)}}this.title="Sugarcane";if(this.passages.StoryTitle){this.title=this.passages.StoryTitle.text}}Tale.prototype.has=function(a){if(typeof a=="string"){return(this.passages[a]!=null)}else{for(i in this.passages){if(this.passages[i].id==a){return true}}return false}};Tale.prototype.get=function(a){if(typeof a=="string"){return this.passages[a]||new Passage(a)}else{for(i in this.passages){if(this.passages[i].id==a){return this.passages[i]}}}};Tale.prototype.lookup=function(h,g,a){var d=[];for(var c in this.passages){var f=this.passages[c];var e=false;for(var b=0;b<f[h].length;b++){if(f[h][b]==g){d.push(f)}}}if(!a){a="title"}d.sort(function(k,j){if(k[a]==j[a]){return(0)}else{return(k[a]<j[a])?-1:+1}});return d};Tale.prototype.reset=function(){for(i in this.passages){this.passages[i].reset()}};function Wikifier(a,b){this.source=b;this.output=a;this.nextMatch=0;this.assembleFormatterMatches(Wikifier.formatters);this.subWikify(this.output)}Wikifier.prototype.assembleFormatterMatches=function(a){this.formatters=[];var b=[];for(var c=0;c<a.length;c++){b.push("("+a[c].match+")");this.formatters.push(a[c])}this.formatterRegExp=new RegExp(b.join("|"),"mg")};Wikifier.prototype.subWikify=function(c,b){var a=this.output;this.output=c;var f=b?new RegExp("("+b+")","mg"):null;do{this.formatterRegExp.lastIndex=this.nextMatch;if(f){f.lastIndex=this.nextMatch}var g=this.formatterRegExp.exec(this.source);var e=f?f.exec(this.source):null;if(e&&(!g||e.index<=g.index)){if(e.index>this.nextMatch){this.outputText(this.output,this.nextMatch,e.index)}this.matchStart=e.index;this.matchLength=e[1].length;this.matchText=e[1];this.nextMatch=e.index+e[1].length;this.output=a;return}else{if(g){if(g.index>this.nextMatch){this.outputText(this.output,this.nextMatch,g.index)}this.matchStart=g.index;this.matchLength=g[0].length;this.matchText=g[0];this.nextMatch=this.formatterRegExp.lastIndex;var h=-1;for(var d=1;d<g.length;d++){if(g[d]){matchingFormatter=d-1}}if(matchingFormatter!=-1){this.formatters[matchingFormatter].handler(this)}}}}while(e||g);if(this.nextMatch<this.source.length){this.outputText(this.output,this.nextMatch,this.source.length);this.nextMatch=this.source.length}this.output=a};Wikifier.prototype.outputText=function(a,c,b){insertText(a,this.source.substring(c,b))};Wikifier.prototype.fullArgs=function(){var b=this.source.indexOf(" ",this.matchStart);var a=this.source.indexOf(">>",this.matchStart);return Wikifier.parse(this.source.slice(b,a))};Wikifier.parse=function(b){var a=b.replace(/\$/g,"state.history[0].variables.");a=a.replace(/\beq\b/gi," == ");a=a.replace(/\bneq\b/gi," != ");a=a.replace(/\bgt\b/gi," > ");a=a.replace(/\beq\b/gi," == ");a=a.replace(/\bneq\b/gi," != ");a=a.replace(/\bgt\b/gi," > ");a=a.replace(/\bgte\b/gi," >= ");a=a.replace(/\blt\b/gi," < ");a=a.replace(/\blte\b/gi," <= ");a=a.replace(/\band\b/gi," && ");a=a.replace(/\bor\b/gi," || ");a=a.replace(/\bnot\b/gi," ! ");return a};Wikifier.formatHelpers={charFormatHelper:function(a){var b=insertElement(a.output,this.element);a.subWikify(b,this.terminator)},inlineCssHelper:function(f){var h=[];var a="(?:("+Wikifier.textPrimitives.anyLetter+"+)\\(([^\\)\\|\\n]+)(?:\\):))|(?:("+Wikifier.textPrimitives.anyLetter+"+):([^;\\|\\n]+);)";var b=new RegExp(a,"mg");var c=false;do{b.lastIndex=f.nextMatch;var d=b.exec(f.source);var e=d&&d.index==f.nextMatch;if(e){var j,g;c=true;if(d[1]){j=d[1].unDash();g=d[2]}else{j=d[3].unDash();g=d[4]}switch(j){case"bgcolor":j="backgroundColor";break}h.push({style:j,value:g});f.nextMatch=d.index+d[0].length}}while(e);return h},monospacedByLineHelper:function(a){var b=new RegExp(this.lookahead,"mg");b.lastIndex=a.matchStart;var c=b.exec(a.source);if(c&&c.index==a.matchStart){var f=c[1];if(navigator.userAgent.indexOf("msie")!=-1&&navigator.userAgent.indexOf("opera")==-1){f=f.replace(/\n/g,"\r")}var d=insertElement(a.output,"pre",null,null,f);a.nextMatch=c.index+c[0].length}}};Wikifier.formatters=[{name:"table",match:"^\\|(?:[^\\n]*)\\|(?:[fhc]?)$",lookahead:"^\\|([^\\n]*)\\|([fhc]?)$",rowTerminator:"\\|(?:[fhc]?)$\\n?",cellPattern:"(?:\\|([^\\n\\|]*)\\|)|(\\|[fhc]?$\\n?)",cellTerminator:"(?:\\x20*)\\|",rowTypes:{c:"caption",h:"thead","":"tbody",f:"tfoot"},handler:function(h){var k=insertElement(h.output,"table");h.nextMatch=h.matchStart;var c=new RegExp(this.lookahead,"mg");var d=null,a;var l,e;var j=[];var g=0;do{c.lastIndex=h.nextMatch;var f=c.exec(h.source);var b=f&&f.index==h.nextMatch;if(b){a=f[2];if(a!=d){l=insertElement(k,this.rowTypes[a])}d=a;if(d=="c"){if(g==0){l.setAttribute("align","top")}else{l.setAttribute("align","bottom")}h.nextMatch=h.nextMatch+1;h.subWikify(l,this.rowTerminator)}else{e=insertElement(l,"tr");this.rowHandler(h,e,j)}g++}}while(b)},rowHandler:function(h,d,m){var a=0;var k=1;var c=new RegExp(this.cellPattern,"mg");do{c.lastIndex=h.nextMatch;var f=c.exec(h.source);matched=f&&f.index==h.nextMatch;if(matched){if(f[1]=="~"){var l=m[a];if(l){l.rowCount++;l.element.setAttribute("rowSpan",l.rowCount);l.element.setAttribute("rowspan",l.rowCount);l.element.valign="center"}h.nextMatch=f.index+f[0].length-1}else{if(f[1]==">"){k++;h.nextMatch=f.index+f[0].length-1}else{if(f[2]){h.nextMatch=f.index+f[0].length;break}else{var b=false,g=false;h.nextMatch++;var o=Wikifier.formatHelpers.inlineCssHelper(h);while(h.source.substr(h.nextMatch,1)==" "){b=true;h.nextMatch++}var j;if(h.source.substr(h.nextMatch,1)=="!"){j=insertElement(d,"th");h.nextMatch++}else{j=insertElement(d,"td")}m[a]={rowCount:1,element:j};lastColCount=1;lastColElement=j;if(k>1){j.setAttribute("colSpan",k);j.setAttribute("colspan",k);k=1}for(var n=0;n<o.length;n++){j.style[o[n].style]=o[n].value}h.subWikify(j,this.cellTerminator);if(h.matchText.substr(h.matchText.length-2,1)==" "){g=true}if(b&&g){j.align="center"}else{if(b){j.align="right"}else{if(g){j.align="left"}}}h.nextMatch=h.nextMatch-1}}}a++}}while(matched)}},{name:"rule",match:"^----$\\n?",handler:function(a){insertElement(a.output,"hr")}},{name:"emdash",match:"--",handler:function(a){var b=insertElement(a.output,"span");b.innerHTML="&mdash;"}},{name:"heading",match:"^!{1,5}",terminator:"\\n",handler:function(a){var b=insertElement(a.output,"h"+a.matchLength);a.subWikify(b,this.terminator)}},{name:"monospacedByLine",match:"^\\{\\{\\{\\n",lookahead:"^\\{\\{\\{\\n((?:^[^\\n]*\\n)+?)(^\\}\\}\\}$\\n?)",handler:Wikifier.formatHelpers.monospacedByLineHelper},{name:"monospacedByLineForPlugin",match:"^//\\{\\{\\{\\n",lookahead:"^//\\{\\{\\{\\n\\n*((?:^[^\\n]*\\n)+?)(\\n*^//\\}\\}\\}$\\n?)",handler:Wikifier.formatHelpers.monospacedByLineHelper},{name:"wikifyCommentForPlugin",match:"^/\\*\\*\\*\\n",terminator:"^\\*\\*\\*/\\n",handler:function(a){a.subWikify(a.output,this.terminator)}},{name:"quoteByBlock",match:"^<<<\\n",terminator:"^<<<\\n",handler:function(a){var b=insertElement(a.output,"blockquote");a.subWikify(b,this.terminator)}},{name:"quoteByLine",match:"^>+",terminator:"\\n",element:"blockquote",handler:function(c){var e=new RegExp(this.match,"mg");var d=[c.output];var h=0;var b=c.matchLength;var g;do{if(b>h){for(g=h;g<b;g++){d.push(insertElement(d[d.length-1],this.element))}}else{if(b<h){for(g=h;g>b;g--){d.pop()}}}h=b;c.subWikify(d[d.length-1],this.terminator);insertElement(d[d.length-1],"br");e.lastIndex=c.nextMatch;var f=e.exec(c.source);var a=f&&f.index==c.nextMatch;if(a){b=f[0].length;c.nextMatch+=f[0].length}}while(a)}},{name:"list",match:"^(?:(?:\\*+)|(?:#+))",lookahead:"^(?:(\\*+)|(#+))",terminator:"\\n",outerElement:"ul",itemElement:"li",handler:function(k){var b=new RegExp(this.lookahead,"mg");k.nextMatch=k.matchStart;var f=[k.output];var l=null,c;var h=0,d;var m;do{b.lastIndex=k.nextMatch;var g=b.exec(k.source);var a=g&&g.index==k.nextMatch;if(a){if(g[1]){c="ul"}if(g[2]){c="ol"}d=g[0].length;k.nextMatch+=g[0].length;if(d>h){for(m=h;m<d;m++){f.push(insertElement(f[f.length-1],c))}}else{if(d<h){for(m=h;m>d;m--){f.pop()}}else{if(d==h&&c!=l){f.pop();f.push(insertElement(f[f.length-1],c))}}}h=d;l=c;var j=insertElement(f[f.length-1],"li");k.subWikify(j,this.terminator)}}while(a)}},{name:"prettyLink",match:"\\[\\[",lookahead:"\\[\\[([^\\|\\]]*?)(?:(\\]\\])|(\\|(.*?)\\]\\]))",terminator:"\\|",handler:function(a){var b=new RegExp(this.lookahead,"mg");b.lastIndex=a.matchStart;var c=b.exec(a.source);if(c&&c.index==a.matchStart&&c[2]){var d=Wikifier.createInternalLink(a.output,c[1]);a.outputText(d,a.nextMatch,a.nextMatch+c[1].length);a.nextMatch+=c[1].length+2}else{if(c&&c.index==a.matchStart&&c[3]){var f;if(tale.has(c[4])){f=Wikifier.createInternalLink(a.output,c[4])}else{f=Wikifier.createExternalLink(a.output,c[4])}a.outputText(f,a.nextMatch,a.nextMatch+c[1].length);a.nextMatch=c.index+c[0].length}}}},{name:"urlLink",match:"(?:http|https|mailto|ftp):[^\\s'\"]+(?:/|\\b)",handler:function(a){var b=Wikifier.createExternalLink(a.output,a.matchText);a.outputText(b,a.matchStart,a.nextMatch)}},{name:"image",match:"\\[(?:[<]{0,1})(?:[>]{0,1})[Ii][Mm][Gg]\\[",lookahead:"\\[([<]{0,1})([>]{0,1})[Ii][Mm][Gg]\\[(?:([^\\|\\]]+)\\|)?([^\\[\\]\\|]+)\\](?:\\[([^\\]]*)\\]?)?(\\])",handler:function(a){var c=new RegExp(this.lookahead,"mg");c.lastIndex=a.matchStart;var d=c.exec(a.source);if(d&&d.index==a.matchStart){var f=a.output;if(d[5]){if(tale.has(d[5])){f=Wikifier.createInternalLink(a.output,d[5])}else{f=Wikifier.createExternalLink(a.output,d[5])}}var b=insertElement(f,"img");if(d[1]){b.align="left"}else{if(d[2]){b.align="right"}}if(d[3]){b.title=d[3]}b.src=d[4];a.nextMatch=d.index+d[0].length}}},{name:"macro",match:"<<",lookahead:"<<([^>\\s]+)(?:\\s*)([^>]*)>>",handler:function(a){var b=new RegExp(this.lookahead,"mg");b.lastIndex=a.matchStart;var c=b.exec(a.source);if(c&&c.index==a.matchStart&&c[1]){var g=c[2].readMacroParams();a.nextMatch=c.index+c[0].length;try{var d=macros[c[1]];if(d&&d.handler){d.handler(a.output,c[1],g,a)}else{insertElement(a.output,"span",null,"marked","macro not found: "+c[1])}}catch(f){throwError(a.output,"Error executing macro "+c[1]+": "+f.toString())}}}},{name:"html",match:"<[Hh][Tt][Mm][Ll]>",lookahead:"<[Hh][Tt][Mm][Ll]>((?:.|\\n)*?)</[Hh][Tt][Mm][Ll]>",handler:function(a){var b=new RegExp(this.lookahead,"mg");b.lastIndex=a.matchStart;var c=b.exec(a.source);if(c&&c.index==a.matchStart){var d=insertElement(a.output,"span");d.innerHTML=c[1];a.nextMatch=c.index+c[0].length}}},{name:"commentByBlock",match:"/%",lookahead:"/%((?:.|\\n)*?)%/",handler:function(a){var b=new RegExp(this.lookahead,"mg");b.lastIndex=a.matchStart;var c=b.exec(a.source);if(c&&c.index==a.matchStart){a.nextMatch=c.index+c[0].length}}},{name:"boldByChar",match:"''",terminator:"''",element:"strong",handler:Wikifier.formatHelpers.charFormatHelper},{name:"strikeByChar",match:"==",terminator:"==",element:"strike",handler:Wikifier.formatHelpers.charFormatHelper},{name:"underlineByChar",match:"__",terminator:"__",element:"u",handler:Wikifier.formatHelpers.charFormatHelper},{name:"italicByChar",match:"//",terminator:"//",element:"em",handler:Wikifier.formatHelpers.charFormatHelper},{name:"subscriptByChar",match:"~~",terminator:"~~",element:"sub",handler:Wikifier.formatHelpers.charFormatHelper},{name:"superscriptByChar",match:"\\^\\^",terminator:"\\^\\^",element:"sup",handler:Wikifier.formatHelpers.charFormatHelper},{name:"monospacedByChar",match:"\\{\\{\\{",lookahead:"\\{\\{\\{((?:.|\\n)*?)\\}\\}\\}",handler:function(a){var b=new RegExp(this.lookahead,"mg");b.lastIndex=a.matchStart;var c=b.exec(a.source);if(c&&c.index==a.matchStart){var d=insertElement(a.output,"code",null,null,c[1]);a.nextMatch=c.index+c[0].length}}},{name:"styleByChar",match:"@@",terminator:"@@",lookahead:"(?:([^\\(@]+)\\(([^\\)]+)(?:\\):))|(?:([^:@]+):([^;]+);)",handler:function(a){var d=insertElement(a.output,"span",null,null,null);var c=Wikifier.formatHelpers.inlineCssHelper(a);if(c.length==0){d.className="marked"}else{for(var b=0;b<c.length;b++){d.style[c[b].style]=c[b].value}}a.subWikify(d,this.terminator)}},{name:"lineBreak",match:"\\n",handler:function(a){insertElement(a.output,"br")}}];Wikifier.textPrimitives={anyDigit:"[0-9]",anyNumberChar:"[0-9\\.E]",urlPattern:"(?:http|https|mailto|ftp):[^\\s'\"]+(?:/|\\b)"};Wikifier.createInternalLink=function(a,c){var b=insertElement(a,"a",c);b.href="javascript:void(0)";if(tale.has(c)){b.className="internalLink"}else{b.className="brokenLink"}b.onclick=function(){state.display(c,b)};if(a){a.appendChild(b)}return b};Wikifier.createExternalLink=function(a,b){var c=insertElement(a,"a");c.href=b;c.className="externalLink";c.target="_blank";if(a){a.appendChild(c)}return c};if(!((new RegExp("[\u0150\u0170]","g")).test("\u0150"))){Wikifier.textPrimitives.upperLetter="[A-Z\u00c0-\u00de]";Wikifier.textPrimitives.lowerLetter="[a-z\u00df-\u00ff_0-9\\-]";Wikifier.textPrimitives.anyLetter="[A-Za-z\u00c0-\u00de\u00df-\u00ff_0-9\\-]"}else{Wikifier.textPrimitives.upperLetter="[A-Z\u00c0-\u00de\u0150\u0170]";Wikifier.textPrimitives.lowerLetter="[a-z\u00df-\u00ff_0-9\\-\u0151\u0171]";Wikifier.textPrimitives.anyLetter="[A-Za-z\u00c0-\u00de\u00df-\u00ff_0-9\\-\u0150\u0170\u0151\u0171]"};

</script>
<style type="text/css">
body{background-color:#000;color:#fff;font-family:Verdana,sans-serif;font-size:62.5%;margin:4em 15% 5% 5em;}#sidebar{position:fixed;top:4.2em;left:7.5em;width:12em;list-style:none;margin:0;padding:0 1em 0 0;font:bold 1.1em Verdana,sans-serif;}
#sidebar li{color:#333;text-align:right;background-repeat:no-repeat;margin-bottom:1em; line-height:1.4em !important; list-style:none;}
#sidebar li:hover{color:#fff;cursor:pointer;}#sidebar li a{color:#333;}#sidebar li a:hover{color:#fff;text-decoration:none;}#sidebar #title{color:#999;font-size:150%;cursor:auto;}#sidebar #title a{color:#999;}#sidebar #title a:hover{color:#fff;}#sidebar 
#storySubtitle{font-size:75%; display:block;}
#storyAuthor{font-size:50%;}#sidebar #storyMenu{display:none;line-height:2.5em;margin-bottom:.5em;}#sidebar #title:hover{color:#999;}#sidebar #credits{padding-top:2em;font-weight:normal;font-size:80%;cursor:auto;}#sidebar #credits:hover{color:#333;}#sidebar #credits a{text-decoration:none;}.menu{position:absolute;display:none;background-color:#343434;color:#fff;opacity:.9;border:1px solid #fff;text-align:left;font:1.1em Verdana;line-height:2em;}.menu div{padding:0 .4em;}.menu div:hover{cursor:pointer;background-color:#fff;color:#343434;}#passages{margin-left:18.2em;border-left:1px solid #333;padding-left:1.5em;}.passage{font-size:1.2em;line-height:175%;margin-bottom:2em;text-align:left;}.passage ul{padding-top:1.3em;/*text-align:center;*/}.passage li{/*display:inline;*/margin-right:6em;}a.internalLink,a.externalLink,a.back,a.return{color:#4d6ad8;font-weight:bold;text-decoration:none;}a.internalLink:hover,a.externalLink:hover,a.back:hover,a.return:hover{color:#8ea6ff;text-decoration:underline;}a.brokenLink{background-color:red;text-decoration:none;color:#000;}.marked{background-color:red;color:#000;margin-right:12px;padding:3px;}.passage ul{margin-left:.5em;padding-left:1.5em;}.passage ol{margin-left:.5em;padding-left:1.5em;}.passage table{border-collapse:collapse;font-size:100%;margin:.8em 1.0em;}.passage th,.passage td,.passage tr,.passage caption{padding:3px;}.passage hr{height:1px;}#storeArea{display:none;}
</style>
</head>
<body>
<ul id="sidebar">
<li id="title"><span id="storyTitle"></span><span id="storySubtitle"></span><span id="titleSeparator"></span><span id="storyAuthor"></span></li>
<li id="storyMenu"></li>
<li id="snapback">Rewind</li>
<li id="restart">Restart</li>
<li id="share">Share</li>
<li id="credits">
This story was created with <a href="http://gimcrackd.com/etc/src/">Twine</a> and is powered by <a href="http://tiddlywiki.com/">TiddlyWiki</a>
</li>
</ul>
<div id="snapbackMenu" class="menu"></div>
<div id="shareMenu" class="menu">
<div onclick="javascript:location.href='http://digg.com/submit?phase=2%20&title='+tale.get('StoryTitle').text+'&url='+location.href">Digg</div>
<div onclick="javascript:location.href='http://del.icio.us/post?title='+tale.get('StoryTitle').text+'&url='+location.href">Delicious</div>
<div onclick="javascript:location.href='http://facebook.com/share.php?t='+tale.get('StoryTitle').text+'&u='+location.href">Facebook</div>
<div onclick="javascript:location.href='http://stumbleupon.com/submit?title='+tale.get('StoryTitle').text+'&url='+location.href">StumbleUpon</div>
<div onclick="javascript:location.href='http://furl.net/storeIt.jsp?t='+tale.get('StoryTitle').text+'&u='+location.href">Furl</div>
</div>
<div id="passages"></div>
<div id="storeArea">
<div tiddler="at last the treasure" tags="treasure" modified="201304131442" created="201304131442" modifier="twee">&lt;&lt;stopsound $sound&gt;&gt; &lt;&lt;playsound &quot;the bells of friendship ring true.ogg&quot;&gt;&gt;\n\n&lt;html&gt;&lt;div class=&quot;right pink&quot;&gt;lol&lt;/div&gt;\n\n&lt;div class=&quot;left lime&quot;&gt;shibe friendship&lt;/div&gt;\n\n&lt;div class=&quot;centerright blue&quot;&gt;was da tru treasure all along&lt;/div&gt;\n\n&lt;div class=&quot;center&quot;&gt;~end~&lt;/div&gt;&lt;/html&gt;\n\n[[credits]]</div><div tiddler="StoryTitle" tags="" modified="201304131508" created="201304131508" modifier="twee">shibequest</div><div tiddler="try riddle" tags="scream" modified="201304131436" created="201304131436" modifier="twee">&lt;&lt;if $riddle == &quot;death&quot;&gt;&gt;\n\n&lt;html&gt;&lt;div class=&quot;center lime&quot;&gt;no wrong&lt;/html&gt;\n\n[[once more|enemy 2 ghost]]\n\n&lt;&lt;else&gt;&gt;\n\n&lt;html&gt;&lt;div class=&quot;center red&quot;&gt;u may pass&lt;/html&gt;\n\n[[at last the treasure]]\n\n&lt;&lt;endif&gt;&gt;</div><div tiddler="ok wow so quest" tags="intro" modified="201304131317" created="201304131317" modifier="twee">&lt;&lt;set $shibe.primary = $primary_stat&gt;&gt;\n&lt;&lt;if $secondary_stat == &quot;u don kno me&quot;&gt;&gt; &lt;&lt;set $shibe.secondary = &quot;aggressive&quot;&gt;&gt; &lt;&lt;endif&gt;&gt; &lt;&lt;if $secondary_stat == &quot;omg wow so frenz&quot;&gt;&gt; &lt;&lt;set $shibe.secondary = &quot;charismatic&quot;&gt;&gt; &lt;&lt;endif&gt;&gt; &lt;&lt;if $shibe.secondary == &quot;aggressive&quot;&gt;&gt; &lt;&lt;set $shibe.strength = 5&gt;&gt; &lt;&lt;else&gt;&gt; &lt;&lt;set $shibe.strength = 3&gt;&gt; &lt;&lt;endif&gt;&gt;\n\n&lt;html&gt;&lt;div class=&quot;centerleft pink&quot;&gt;empty&lt;/div&gt;\n\n&lt;div class=&quot;green&quot;&gt;sorrow&lt;/div&gt;\n\n&lt;div class=&quot;right red&quot;&gt;the fate of da kingdom&lt;/div&gt;\n\n&lt;div class=&quot;center pink&quot;&gt;lol brave knight u are my onli hope&lt;/div&gt;&lt;/html&gt;\n\n[[on da road|encounter1]]</div><div tiddler="fight enemy1" tags="fight1" modified="201304131345" created="201304131345" modifier="twee">&lt;&lt;set $enemy = {strength: 2, hp: 5, dead: false}&gt;&gt; &lt;&lt;stopsound $sound&gt;&gt; &lt;&lt;set $sound = &quot;the war warrior.ogg&quot;&gt;&gt; &lt;&lt;loopsound $sound&gt;&gt;\n\n&lt;html&gt;&lt;div class=&quot;center pink&quot;&gt;its time&lt;/div&gt;\n\n&lt;br&gt;&lt;br&gt;\n\n&lt;div class=&quot;right green&quot;&gt;are you ready for shibe&lt;/div&gt;&lt;/html&gt;\n\n[[attack|attack enemy 1]]</div><div tiddler="dead" tags="dead" modified="201304131340" created="201304131340" modifier="twee">&lt;&lt;stopsound $sound&gt;&gt; &lt;&lt;set $over = &quot;shibe over.ogg&quot;&gt;&gt; &lt;&lt;playsound $over&gt;&gt; &lt;html&gt;&lt;div class=&quot;center red&quot;&gt;wow&lt;/div&gt;\n\n&lt;div class=&quot;centerright green&quot;&gt;so dead&lt;/div&gt;\n\n&lt;div class=&quot;centerleft blue&quot;&gt;is this the end of shibe&lt;/div&gt;\n\n&lt;div class=&quot;center pink&quot;&gt;this story is not hppay end~&lt;/div&gt;&lt;/html&gt;\n\n[[restart|Start]]</div><div tiddler="Start" tags="smaufrai" modified="201304122259" created="201304122259" modifier="twee">&lt;&lt;set $shibe = {hp: 5, dead: false}&gt;&gt; &lt;&lt;if $over&gt;&gt; &lt;&lt;stopsound $over&gt;&gt; &lt;&lt;set $over = false&gt;&gt; &lt;&lt;endif&gt;&gt; &lt;&lt;loopsound &quot;journ.ogg&quot;&gt;&gt;\n&lt;html&gt;&lt;div class=&quot;center red&quot;&gt;wow&lt;/div&gt;\n&lt;div class=&quot;centerright green&quot;&gt;shibe warrior gonna war&lt;/div&gt;&lt;/html&gt;so &lt;&lt;cyclinglink $primary_stat &quot;brave&quot; &quot;smrat&quot;&gt;&gt;\n\n&lt;&lt;cyclinglink $secondary_stat &quot;u don kno me&quot; &quot;omg wow so frenz&quot;&gt;&gt;\n\n[[ok wow so quest]]</div><div tiddler="enemy 2 ghost" tags="enemy2ghost" modified="201304131410" created="201304131410" modifier="twee">\n&lt;html&gt;&lt;div class=&quot;center red&quot;&gt;no not shibe ghost&lt;/div&gt;&lt;/html&gt;\n\n&lt;&lt;if $shibe.primary == &quot;smrat&quot;&gt;&gt; &lt;html&gt;\n\n&lt;div class=&quot;right pink&quot;&gt;shiba riddles&lt;/div&gt;\n\n&lt;div class=&quot;centerleft black&quot;&gt;its the only way&lt;/div&gt;\n\n&lt;div class=&quot;center red&quot;&gt;what is blacker than night&lt;/div&gt;\n\n&lt;div class=&quot;blue centerright&quot;&gt;darker than shade&lt;/div&gt;\n\n&lt;div class=&quot;lime center&quot;&gt;sharper than any blade&lt;/div&gt;&lt;/html&gt;\n\n&lt;&lt;cyclinglink $riddle &quot;death&quot; &quot;shibe soul&quot;&gt;&gt; &lt;&lt;if $sound != &quot;spookshib.ogg&quot;&gt;&gt; &lt;&lt;stopsound $sound&gt;&gt; &lt;&lt;set $sound = &quot;spookshib.ogg&quot;&gt;&gt; &lt;&lt;loopsound $sound&gt;&gt; &lt;&lt;endif&gt;&gt;\n\n[[i kno|try riddle]]\n\n&lt;&lt;else&gt;&gt;\n\n&lt;html&gt;&lt;div class=&quot;right pink&quot;&gt;ghost fight&lt;/div&gt;\n\n&lt;div class=&quot;center blue&quot;&gt;its the only way&lt;/div&gt;&lt;/html&gt; &lt;&lt;set $enemy = {strength: 3, hp: 4, dead: false}&gt;&gt;\n\n[[take me on|attack enemy 2]]\n\n&lt;&lt;endif&gt;&gt;</div><div tiddler="cyclinglink" tags="script" modified="201304131212" created="201304131212" modifier="twee">version.extensions[&quot;cyclinglinkMacro&quot;]={major:3,minor:1,revision:1};macros.cyclinglink={handler:function(a,b,c){var l=Wikifier.createInternalLink(a,null);\nl.className=&quot;internalLink cyclingLink&quot;;l.setAttribute(&quot;data-cycle&quot;,0);var v=&quot;&quot;;var end=false;\nif(c.length&&c[0][0]==&quot;$&quot;){v=c[0].slice(1);c.shift();}if(c[c.length-1]==&quot;end&quot;){end=true;\nc.pop();}var h=state.history[0].variables;for(var i=0;i&lt;c.length;i++){var on=(i==Math.max(c.indexOf(h[v]),0));\nvar d=insertElement(null,&quot;span&quot;,null,&quot;cyclingLink&quot;+((on)?&quot;En&quot;:&quot;Dis&quot;)+&quot;abled&quot;);if(on){h[v]=c[ i ];\nl.setAttribute(&quot;data-cycle&quot;,i);}insertText(d,c[ i ]);l.appendChild(d);}l.onclick=function(){var t=this.childNodes;\nvar d=&quot;cyclingLink&quot;;var u=this.getAttribute(&quot;data-cycle&quot;)-0;var m=t.length;if(end&&u==m-2){var n=this.removeChild(t[u+1]);\nn.className=d+&quot;End&quot;;this.parentNode.replaceChild(n,this);return;}t[u].classList.toggle(d+&quot;Enabled&quot;);\nt[u].classList.toggle(d+&quot;Disabled&quot;);u=(u+1)%m;if(v){h[v]=c[u];}t[u].classList.toggle(d+&quot;Enabled&quot;);\nt[u].classList.toggle(d+&quot;Disabled&quot;);this.setAttribute(&quot;data-cycle&quot;,u);};},init:function(){addStyle(&quot;.cyclingLinkDisabled { display:none; } &quot;);\n}};macros.cyclinglink.init();\n</div><div tiddler="CSS" tags="stylesheet" modified="201304122301" created="201304122301" modifier="twee">.center\n{\ntext-align: center;\n}\n\n.right\n{\ntext-align: right;\n}\n\n.centerright\n{\nmargin-left: 80%;\n}\n\n.centerleft\n{\nmargin-right: 80%;\n}\n\n.red {color:red;}\n.blue {color:#AFEEEE;}\n.green {color:#8FBC8F;}\n.pink {color:#FFB6C1;}\n.black {color:black;}\n.lime {color:#7CFC00;}\na:link {color:#00BFFF;}\n\n.passage\n{\nwidth: 500px;\nheight: 500px;\noverflow-x: visible;\noverflow-y: visible;\nbackground-color: black;\nbackground-repeat: no-repeat;\nbackground-position: center;\nfont-family: &quot;Comic Sans MS&quot;;\nfont-size: 1.5em;\ncolor: #FFEBCD;\n}\n\n.passage .content\n{\npadding: 50px 85px 50px 85px;\n}\n\n[data-tags~=smaufrai]\n{\nbackground-image:url('smaufrai.jpg');\n}\n\n[data-tags~=intro]\n{\nbackground-image:url('intro.jpg');\n}\n\n[data-tags~=meetenemy1]\n{\nbackground-image:url('enemy1.jpg');\n}\n\n[data-tags~=dead]\n{\nbackground-image:url('dead.jpg');\n}\n\n[data-tags~=fight1]\n{\nbackground-image:url('fight1.jpg');\n}\n\n[data-tags~=enemy2]\n{\nbackground-image:url('enemy2.jpg');\n}\n\n[data-tags~=enemy2ghost]\n{\nbackground-image:url('enemy2ghost.jpg');\n}\n\n[data-tags~=scream]\n{\nbackground-image:url('scream.jpg');\n}\n\n[data-tags~=treasure]\n{\nbackground-image:url('friends.jpg');\n}</div><div tiddler="combat loop 1" tags="" modified="201304131355" created="201304131355" modifier="twee">&lt;&lt;set $dmg = Math.floor(Math.random() * $shibe.strength) + 1&gt;&gt;\n\n&lt;&lt;set $get = Math.floor(Math.random() * $enemy.strength) + 1&gt;&gt;\n\n&lt;html&gt;&lt;div class=&quot;center blue&quot;&gt;grrrrr&lt;/div&gt;&lt;/html&gt;\n\nyou hit for &lt;&lt;print $dmg&gt;&gt; &lt;&lt;set $enemy.hp -= $dmg&gt;&gt; &lt;&lt;if $enemy.hp &lt; 1&gt;&gt; &lt;&lt;set $enemy.dead = true&gt;&gt; &lt;&lt;endif&gt;&gt;\n\n&lt;html&gt;&lt;div class=&quot;center red&quot;&gt;omg what&lt;/div&gt;&lt;/html&gt;\n\nenemy hits for &lt;&lt;print $get&gt;&gt; &lt;&lt;set $shibe.hp -= $get&gt;&gt; &lt;&lt;if $shibe.hp &lt; 1&gt;&gt; &lt;&lt;set $shibe.dead = true&gt;&gt; &lt;&lt;endif&gt;&gt;</div><div tiddler="attack enemy 1" tags="fight1" modified="201304131355" created="201304131355" modifier="twee">&lt;&lt;display &quot;combat loop 1&quot;&gt;&gt;\n\n&lt;&lt;if $enemy.dead && !$shibe.dead&gt;&gt;\n[[thats what i thought|encounter2]]\n&lt;&lt;else&gt;&gt;\n&lt;&lt;if $shibe.dead&gt;&gt;\n[[wat noooooo|dead]]\n&lt;&lt;else&gt;&gt;\n[[hit me again|attack enemy 1]]\n&lt;&lt;endif&gt;&gt;\n&lt;&lt;endif&gt;&gt;</div><div tiddler="StoryAuthor" tags="" modified="201304131952" created="201304131952" modifier="twee">Ms. Tea</div><div tiddler="attack enemy 2" tags="scream" modified="201304131438" created="201304131438" modifier="twee">&lt;html&gt;&lt;div class=&quot;red&quot;&gt;shibe this is ur most fersome foe yet&lt;/div&gt;&lt;/html&gt;\n&lt;&lt;display &quot;combat loop 2&quot;&gt;&gt;\n\n&lt;&lt;if $enemy.dead && !$shibe.dead&gt;&gt;\n[[at last the treasure]]\n&lt;&lt;else&gt;&gt;\n&lt;&lt;if $shibe.dead&gt;&gt;\n[[wat noooooo|dead]]\n&lt;&lt;else&gt;&gt;\n[[hit me again|attack enemy 2]]\n&lt;&lt;endif&gt;&gt;\n&lt;&lt;endif&gt;&gt;</div><div tiddler="credits" tags="" modified="201304131527" created="201304131527" modifier="twee">Text/etc: Ms. Tea\nMusic: SF\n\nMost photos used under Creative Commons licenses.\n\n* [[smaufrai from @DogSolutions|http://twitter.com/DogSolutions/status/210836474025881600/photo/1]]\n* [[tokyo the shiba by _tar0_ on Flickr|http://www.flickr.com/photos/_tar0_/5958945531/]]\n* [[Shiba inu by Yuya Tamai on Flickr|http://www.flickr.com/photos/tamaiyuya/6073282904/]]\n* [[Shiba in the snow by Truk71 on Flickr|http://www.flickr.com/photos/24161110@N00/399356547/]]\n* [[shiba rinji wrestles with shiba taro by _tar0_ on Flickr|http://www.flickr.com/photos/_tar0_/6174353458/]]\n* [[shiba shadow by _tar0_ on Flickr|http://www.flickr.com/photos/_tar0_/7207054956/]]\n* [[Shiba #2 by atubbs on Flickr|http://www.flickr.com/photos/atubbs/3189700418/]]\n* [[taro shiba yawning by _tar0_ on Flickr|http://www.flickr.com/photos/_tar0_/5106890898/]]\n* [[shiba siblings (kiyom & taro) & their lazy sunday|http://www.flickr.com/photos/_tar0_/7390117678/]]\n\n&lt;html&gt;&lt;a rel=&quot;license&quot; href=&quot;http://creativecommons.org/licenses/by/3.0/deed.en_US&quot;&gt;&lt;img alt=&quot;Creative Commons License&quot; style=&quot;border-width:0&quot; src=&quot;http://i.creativecommons.org/l/by/3.0/88x31.png&quot; /&gt;&lt;/a&gt;&lt;br /&gt;&lt;span xmlns:dct=&quot;http://purl.org/dc/terms/&quot; property=&quot;dct:title&quot;&gt;shibequest&lt;/span&gt; by &lt;a xmlns:cc=&quot;http://creativecommons.org/ns#&quot; href=&quot;http://dl.dropboxusercontent.com/u/79581979/shibe.html&quot; property=&quot;cc:attributionName&quot; rel=&quot;cc:attributionURL&quot;&gt;Ms. Tea / SF&lt;/a&gt; is licensed under a &lt;a rel=&quot;license&quot; href=&quot;http://creativecommons.org/licenses/by/3.0/deed.en_US&quot;&gt;Creative Commons Attribution 3.0 Unported License&lt;/a&gt;.&lt;/html&gt;</div><div tiddler="audio" tags="script" modified="201304131952" created="201304131952" modifier="twee">\n(function () {\n  version.extensions['soundMacros'] = {\n    major: 1,\n    minor: 1,\n    revision: 1\n  };\n  var p = macros['playsound'] = {\n    soundtracks: {},\n    handler: function (a, b, c, d) {\n      var loop = function (m) {\n          if (m.loop == undefined) {\n            m.loopfn = function () {\n              this.play();\n            };\n            m.addEventListener('ended', m.loopfn, 0);\n          } else m.loop = true;\n          m.play();\n          };\n      var s = eval(d.fullArgs());\n      if (s) {\n        s = s.toString();\n        var m = this.soundtracks[s.slice(0, s.lastIndexOf(&quot;.&quot;))];\n        if (m) {\n          if (b == &quot;playsound&quot;) {\n            m.play();\n          } else if (b == &quot;loopsound&quot;) {\n            loop(m);\n          } else if (b == &quot;pausesound&quot;) {\n            m.pause();\n          } else if (b == &quot;unloopsound&quot;) {\n            if (m.loop != undefined) {\n              m.loop = false;\n            } else if (m.loopfn) {\n              m.removeEventListener('ended', m.loopfn);\n              delete m.loopfn;\n            }\n          } else if (b == &quot;stopsound&quot;) {\n            m.pause();\n            m.currentTime = 0;\n          } else if (b == &quot;fadeoutsound&quot; || b == &quot;fadeinsound&quot;) {\n            if (m.interval) clearInterval(m.interval);\n            if (b == &quot;fadeinsound&quot;) {\n              if (m.currentTime&gt;0) return;\n              m.volume = 0;\n              loop(m);\n            } else {\n              if (!m.currentTime) return;\n              m.play();\n            }\n            var v = m.volume;\n            m.interval = setInterval(function () {\n              v = Math.min(1, Math.max(0, v + 0.005 * (b == &quot;fadeinsound&quot; ? 1 : -1)));\n              m.volume = Math.easeInOut(v);\n              if (v == 0 || v == 1) clearInterval(m.interval);\n              if (v == 0) {\n                m.pause();\n                m.currentTime = 0;\n                m.volume = 1;\n              }\n            }, 10);\n          }\n        }\n      }\n    }\n  }\n  macros['fadeinsound'] = p;\n  macros['fadeoutsound'] = p;\n  macros['unloopsound'] = p;\n  macros['loopsound'] = p;\n  macros['pausesound'] = p;\n  macros['stopsound'] = p;\n  macros['stopallsound'] = {\n    handler: function () {\n      var s = macros.playsound.soundtracks;\n      for (var j in s) {\n        var i = s[j];\n        i.pause();\n        i.currentTime = 0;\n      }\n    }\n  }\n  var div = $(&quot;storeArea&quot;).firstChild;\n  var fe = [&quot;ogg&quot;, &quot;mp3&quot;, &quot;wav&quot;, &quot;webm&quot;];\n  while (div) {\n    var b = String.fromCharCode(92);\n    var q = '&quot;';\n    var re = &quot;['&quot; + q + &quot;]([^&quot; + q + &quot;']*?)&quot; + b + &quot;.(ogg|mp3|wav|webm)['&quot; + q + &quot;]&quot;;\n    k(new RegExp(re, &quot;gi&quot;));\n    div = div.nextSibling;\n  }\n\n  function k(c, e) {\n    do {\n      d = c.exec(div.innerHTML);\n      if (d) {\n        var a = new Audio();\n        if (a.canPlayType) {\n          for (var i = -1; i &lt; fe.length; i += 1) {\n            if (i &gt;= 0) d[2] = fe[i];\n            if (a.canPlayType(&quot;audio/&quot; + d[2])) break;\n          }\n          if (i &lt; fe.length) {\n            a.setAttribute(&quot;src&quot;, d[1] + &quot;.&quot; + d[2]);\n            a.interval = null;\n            macros.playsound.soundtracks[d[1]] = a;\n          } else console.log(&quot;Browser can't play '&quot; + d[1] + &quot;'&quot;);\n        }\n      }\n    } while (d);\n  }\n}());\n</div><div tiddler="talk enemy1" tags="meetenemy1" modified="201304131352" created="201304131352" modifier="twee">&lt;&lt;if $shibe.secondary == &quot;charismatic&quot;&gt;&gt;\n\n&lt;html&gt;&lt;div class=&quot;right green&quot;&gt;the code of the honores&lt;/div&gt; &lt;br&gt;&lt;br&gt;\n\n&lt;div class=&quot;pink&quot;&gt;the way of the warriors&lt;/div&gt; &lt;br&gt;&lt;br&gt;&lt;br&gt;\n\n&lt;div class=&quot;center blue&quot;&gt;shibe know respect&lt;/div&gt;&lt;/html&gt;\n\n[[go from this place|encounter2]]\n\n&lt;&lt;else&gt;&gt;\n\n&lt;html&gt;&lt;div class=&quot;pink&quot;&gt;no&lt;/div&gt;\n\n&lt;div class=&quot;red right&quot;&gt;this ends now&lt;/div&gt;&lt;/html&gt;\n\n[[take on me|fight enemy1]]\n\n&lt;&lt;endif&gt;&gt;</div><div tiddler="encounter2" tags="enemy2" modified="201304131405" created="201304131405" modifier="twee">&lt;&lt;if $sound != &quot;wheel of fate.ogg&quot;&gt;&gt; &lt;&lt;stopsound $sound&gt;&gt; &lt;&lt;set $sound = &quot;wheel of fate.ogg&quot;&gt;&gt; &lt;&lt;loopsound $sound&gt;&gt; &lt;&lt;endif&gt;&gt; &lt;html&gt;&lt;div class=&quot;right green&quot;&gt;wat&lt;/div&gt;\n\n&lt;br&gt;&lt;br&gt;&lt;br&gt;\n\n&lt;div class=&quot;red&quot;&gt;shadow what is this&lt;/div&gt;&lt;/html&gt;\n\n[[go look|enemy 2 ghost]]</div><div tiddler="encounter1" tags="meetenemy1" modified="201304131319" created="201304131319" modifier="twee">&lt;&lt;stopsound &quot;journ.ogg&quot;&gt;&gt; &lt;&lt;set $sound = &quot;wheel of fate.ogg&quot;&gt;&gt; &lt;&lt;loopsound $sound&gt;&gt;\n\n&lt;html&gt;&lt;div class=&quot;center red&quot;&gt;u want to get wit me bitch&lt;/div&gt;\n\n&lt;div class=&quot;centerright blue&quot;&gt;u messin wit da wrong shibe&lt;/div&gt;&lt;/html&gt;\n\n[[fight|fight enemy1]]\n\n[[talk|talk enemy1]]</div><div tiddler="combat loop 2" tags="" modified="201304131435" created="201304131435" modifier="twee">&lt;&lt;set $dmg = Math.floor(Math.random() * $shibe.strength) + 1&gt;&gt;\n\n&lt;&lt;set $get = Math.floor(Math.random() * $enemy.strength) + 1&gt;&gt;\n\n&lt;html&gt;&lt;div class=&quot;blue&quot;&gt;grrrrr&lt;/div&gt;&lt;/html&gt;\n\nyou hit for &lt;&lt;print $dmg&gt;&gt; &lt;&lt;set $enemy.hp -= $dmg&gt;&gt; &lt;&lt;if $enemy.hp &lt; 1&gt;&gt; &lt;&lt;set $enemy.dead = true&gt;&gt; &lt;&lt;endif&gt;&gt;\n\n&lt;html&gt;&lt;div class=&quot;red&quot;&gt;wooooo no&lt;/div&gt;&lt;/html&gt;\n\nghost hits for &lt;&lt;print $get&gt;&gt; &lt;&lt;set $shibe.hp -= $get&gt;&gt; &lt;&lt;if $shibe.hp &lt; 1&gt;&gt; &lt;&lt;set $shibe.dead = true&gt;&gt; &lt;&lt;endif&gt;&gt;</div></div></body></html>